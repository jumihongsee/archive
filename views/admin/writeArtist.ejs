<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archive - Artist Register</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <%- include('../nav.ejs') %>
    <%- include('../sidenav.ejs') %>

    <section class="write admin">
     
        <form action="<%= data ? '/edit/artist' : '/write/artist' %>" method="POST" enctype="multipart/form-data">
            <div class="img">       
                <label for="file">
                    <div class="preview-img-wrapper">
                        <% if(data){ %>
                            <% data.forEach((item)=>{ %>
                                <img src="<%= item.imgUrl %>"  id="previewImg" name="" alt="">    
                                <input type="hidden" name="oldImg" id="previewImg" value="<%= item.imgUrl %>">
                            <% }) %>
                        <% }else{ %>
                            <img src="/img/user.svg"  id="previewImg" name="" alt="">    
                        <% } %>
                    
                    </div>
          
                    <input name="artistimg" class="file" id="file" type="file" accept="image/*" onchange="previewImage(event)">
                    <img src="/img/plus.png" class="plus"  alt="">
                </label>              
            </div>
            <div class="info-form info">
                <h2>Artist Info</h2>
                <label for="artistnameKr">
                    <p>이름 (Kor) <span>* 필수 입력값</span></p>
                    <% if(data){ %>
                        <%  data.forEach((item) =>{ %>
                            <input type="text" name="artistnameKr" id="artistnameKr" value="<%= item.artistName[0]  %>">
                        <% }) %>
                    <% }else{ %>
                        <input type="text" name="artistnameKr" id="artistnameKr" value="">
                    <% } %>

                </label>
                <label for="artistnameEng">
                    <p>이름 (Eng) <span>* 필수 입력값</span></p> 
                    <% if(data){ %>
                        <%  data.forEach((item) =>{ %>
                            <input type="text" name="artistnameEng" id="artistnameEng" value="<%= item.artistName[1]  %>">
                        <% }) %>
                    <% }else{ %>
                        <input type="text" name="artistnameEng" id="artistnameEng" >
                    <% } %>
                
                </label>
                <label for="artistBirth">
                    <p>생년월일</p>   
                    <% if(data){ %>
                        <%  data.forEach((item) =>{ %>
                            <input type="date" name="artistBirth" id="artistBirth" value="<%= item.artistBirth %>" >
                        <% }) %>
                    <% }else{ %>
                        <input type="date" name="artistBirth" id="artistBirth" >
                    <% } %>


                    
                </label>
                <label for="artistEmail">
                    <p>연락처 (email)</p> 
                    <% if(data){ %>
                        <%  data.forEach((item) =>{ %>
                            <input type="email" name="artistEmail" id="artistEmail" value="<%= item.artistEmail %>">
                        <% }) %>
                    <% }else{ %>
                        <input type="email" name="artistEmail" id="artistEmail">
                    <% } %>                   
                </label>

                <label for="artistTel">
                    <p>연락처 (tel)</p> 
                    <% if(data){ %>
                        <%  data.forEach((item) =>{ %>
                            <input type="number" name="artistTel" id="artistTel" value="<%= item.artistTel %>">
                        <% }) %>
                    <% }else{ %>
                        <input type="number" name="artistTel" id="artistTel"> 
                    <% } %>
                                  
                </label>
                <label for="artistHome">
                    <p>홈페이지 (homepage)</p> 
                    <% if(data){ %>
                        <%  data.forEach((item) =>{ %>
                            <input type="text" name="artistHome" id="artistHome" value="<%= item.artistHome %>">
                        <% }) %>
                    <% }else{ %>
                        <input type="text" name="artistHome" id="artistHome">  
                    <% } %>
                             
                </label>
            </div>
            <div class="info-form career">
                <h2>Artist Career</h2>   
                <div class="education wrapper">
                    <% if(data){ %>
                        <% data.forEach((item)=>{ %>
                            <% if(item.education && item.education.length > 0){ %>
                                <% item.education.forEach((edu)=>{ %>
                                    <div class="createWrapper">
                                        <div class="solo-ex-input">
                                            <label for="soloExDate">
                                                학력
                                                <input type="date" name="EducationDate" id="soloExDate" value="<%= edu.date %>">
                                            </label>
                                            <label for="soloExTitle">
                                                학교이름
                                                <input type="text" name="EducationTitle" id="soloExTitle" value="<%= edu.school %>">
                                            </label>
                                            <button type="button" class="input-delete"><img src="/img/x.png" alt=""></button>
                                        </div>
                                    </div>
                                <% })  %>
                            <% } %>
                        <% }) %>
                    <% }else{ %>

                    <% } %>


                    <button class="addInput"><img src="/img/plus.png" alt=""> 학력 추가</button>
                </div>


                <div class="solo-ex wrapper">

                    <% if(data){ %>
                        <% data.forEach((item)=>{ %>
                            <% if(item.soloEx && item.soloEx.length > 0){ %>
                                <% item.soloEx.forEach((soloEx)=>{ %>
                                    <div class="createWrapper">
    
                                        <div class="solo-ex-input">
                                            <label for="soloExDate">
                                                개인전 
                                                <input type="date" name="soloExDate" id="soloExDate" value="<%= soloEx.date %>">
                                            </label>
                                            <label for="soloExTitle">
                                                전시 타이틀
                                                <input type="text" name="soloExTitle" id="soloExTitle" value="<%= soloEx.exTitle %>">
                                            </label>
                                            <button type="button" class="input-delete"><img src="/img/x.png" alt=""></button>
                                        </div>
    
                                    </div>
    
                                <% })  %>
                            <%}%>
                           

                        <% }) %>

                    <% }else{ %>

                    <% } %>

                    <button class="addInput"><img src="/img/plus.png" alt=""> 개인전 경력추가</button>
                </div>


                <div class="group-ex wrapper">
                    
                    <% if(data){ %>
                        <% data.forEach((item)=>{ %>
                            <% if(item.groupEx && item.groupEx.length > 0){ %>
                                <% item.groupEx.forEach((groupEx)=>{ %>
                                    <div class="createWrapper">
                                        <div class="group-ex-input">
                                            <label for="groupExDate">
                                                단체전 
                                                <input type="date" name="groupExDate" id="groupExDate" value="<%= groupEx.date %>">
                                            </label>
                                            <label for="groupExTitle">
                                                전시 타이틀
                                                <input type="text" name="groupExTitle" id="groupExTitle" value="<%= groupEx.exTitle %>">
                                            </label>
                                             <button type="button" class="input-delete"><img src="/img/x.png" alt=""></button>
                                        </div>
                                    </div>
                                <% })  %>
                            <% } %>
                            
                        <% }) %>

                    <% }else{ %>

                    <% } %>
                    <button class="addInput"><img src="/img/plus.png" alt="">그룹전 경력추가</button>
                </div>
                <div class="award wrapper">
                    <% if (data) { %>
                        <% data.forEach((item) => { %>
                            <% if (item.award && item.award.length > 0) { %>
                                <% item.award.forEach((award) => { %>
                                    <div class="createWrapper">
                                        <div class="award-input">
                                            <label for="awardExDate">
                                                수상
                                                <input type="date" name="awardExDate" id="awardExDate" value="<%= award.date %>">
                                            </label>
                                            <label for="awardTitle">
                                                수상 타이틀
                                                <input type="text" name="awardTitle" id="awardTitle" value="<%= award.exTitle %>">
                                            </label>
                                            <button type="button" class="input-delete"><img src="/img/x.png" alt=""></button>
                                        </div>
                                    </div>
                                <% }) %>
                            <% } %>
                        <% }) %>
                    <% } %>
                    <button class="addInput"><img src="/img/plus.png" alt="">수상 경력추가</button>
                </div>

            </div>
            <div class="info-form description">
                <h2>description</h2>   
                <label for="artistNote">
                    아티스트 노트
                    <textarea name="artistNote" id="artistNote"></textarea>      
                </label>
                <label for="artistDescription">
                    메모
                    <textarea name="artistDescription" id="artistDescription"></textarea>      
                </label>
               
            </div>
            <% if(data){ %>
                <% data.forEach((item)=>{ %>
                    <input type="hidden" name="artistId" value="<%=  item._id %>">
                <% }) %>
            
            <% } %>

            <button type="submit" class="submit-btn" >
                <% if(data){ %>
                    수정하기
                <% }else{ %>
                    등록하기
                <% } %>
            </button>

        </form>
    </section>

    <script>

     // 이미지 미리보기 기능
        document.getElementById('file').addEventListener('change', function(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('preview');
            const reader = new FileReader();

            reader.onload = function(e) {
                preview.src = e.target.result; // 미리보기 이미지의 src를 변경
            };

            if (file) {
                reader.readAsDataURL(file); // 파일을 읽어 데이터 URL로 변환
            } else {
                preview.src = '/img/user.svg'; // 파일이 없을 경우 기본 s이미지로 설정
            }
        });


        const addBtn = document.querySelectorAll('.addInput');
        
        // 인풋 추가 버튼
        addBtn.forEach(item =>{
           


            item.addEventListener('click', function(e){

                e.preventDefault();
                // item의 부모값 
                const inputWrapper = item.parentNode;
                const inputWrapperClass = inputWrapper.className;
                let newInputGroup = document.createElement('div');
                
                

                
                newInputGroup.classList.add('createWrapper')

                if(inputWrapperClass === "education wrapper"){
                    newInputGroup.innerHTML =
                    `
                        <div class="solo-ex-input">
                            <label for="soloExDate">
                                학력
                                <input type="date" name="EducationDate" id="soloExDate">
                            </label>
                            <label for="soloExTitle">
                                학교이름
                                <input type="text" name="EducationTitle" id="soloExTitle">
                            </label>
                            <button type="button" class="input-delete"><img src="/img/x.png" alt=""></button>
                        </div>
                    `
                }
                else if(inputWrapperClass === "solo-ex wrapper"){
                    newInputGroup.innerHTML = 
                    `
                        <div class="solo-ex-input">
                            <label for="soloExDate">
                                개인전 
                                <input type="date" name="soloExDate" id="soloExDate">
                            </label>
                            <label for="soloExTitle">
                                전시 타이틀
                                <input type="text" name="soloExTitle" id="soloExTitle">
                            </label>
                            <button type="button" class="input-delete"><img src="/img/x.png" alt=""></button>
                        </div>
                    `

           
                }
                else if(inputWrapperClass === "group-ex wrapper"){
                    newInputGroup.innerHTML = 
                    `
                        <div class="group-ex-input">
                            <label for="groupExDate">
                                단체전 
                                <input type="date" name="groupExDate" id="groupExDate">
                            </label>
                            <label for="groupExTitle">
                                전시 타이틀
                                <input type="text" name="groupExTitle" id="groupExTitle">
                            </label>
                             <button type="button" class="input-delete"><img src="/img/x.png" alt=""></button>
                        </div>
                    `
                }
                else if(inputWrapperClass === "award wrapper"){
                    newInputGroup.innerHTML = 
                    `
                        <div class="award-input">
                            <label for="awardExDate">
                                수상
                                <input type="date" name="awardExDate" id="awardExDate">
                            </label>
                            <label for="awardTitle">
                                수상 타이틀
                                <input type="text" name="awardTitle" id="awardTitle">
                            </label>
                             <button type="button" class="input-delete"><img src="/img/x.png" alt=""></button>
                        </div>
                    `
                }


             
                inputWrapper.insertBefore(newInputGroup, item);
              
          

            })
        })

        //이벤트 델리게이션을 사용하여 삭제 버튼 클릭 
        const deleteBtnWrapper = document.querySelector('.write'); // 전체 form을 감싸는 상위 요소 선택
        deleteBtnWrapper.addEventListener('click', function(e){
            if(e.target && e.target.closest('.input-delete')){
                const deleteInputBtn = e.target.closest('.input-delete');
                const inputGroup = deleteInputBtn.closest('.createWrapper');
                if(inputGroup){
                    inputGroup.remove(); // .wrapper가 아닌 삭제할 개별 입력 그룹만 제거
                }
            }
        });

        //텍스트 길이 만큼 height 조정
        const textarea = document.querySelectorAll('textarea');
        textarea.forEach(item=>{
            item.addEventListener('input', function(){
                item.style.height = 'auto'
                item.style.height = this.scrollHeight+'px'
            })
        })

        //이미지 미리보기 
        function previewImage(event){
            const file = event.target.files[0];
            const reader = new FileReader(); // FileReader 객체 생성
            reader.onload = function(){
                const previewImg= document.getElementById('previewImg')
                previewImg.src = reader.result;
      
            }
            if (file) {
                reader.readAsDataURL(file); // 파일을 Data URL로 읽어옵니다.
            }
            console.log(reader.result)
        }



    </script>


</body>
</html>